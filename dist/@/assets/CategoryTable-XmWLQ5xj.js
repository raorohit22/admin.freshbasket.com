import{r as b,S as Q,s as B,q,h as X,j as e,e as m,k as $}from"./index-JntRuJ30.js";import{u as K,S as Z,I as y}from"./Layout-CJRk6bmQ.js";import{T as ee,C as se,S as ae}from"./BulkActionDrawer-Cp0k9QtM.js";import{T as k,D as te,u as ne,M as le}from"./DrawerButton-DKGFVCHx.js";import{D as re,E as ie}from"./EditDeleteButton-Cv-N0Zrc.js";import{T as de}from"./ParentCategory-BCkGlcoL.js";import{u as oe,E as z}from"./index.esm-NZsJ6F5_.js";import{I as me}from"./InputArea-CZ3wjyPy.js";import{L as U}from"./LabelArea-CoIOgRmi.js";import{S as ce}from"./SwitchToggle-zfe468pS.js";import{U as pe}from"./Uploader-CbUcrU5G.js";import{C as P}from"./ProductServices-DFc4uHnR.js";import{u as xe}from"./useTranslationValue-aEJQtv0R.js";const ue=(i,c)=>{const{isDrawerOpen:n,closeDrawer:f,setIsUpdate:p,lang:I}=b.useContext(Q),[d,C]=b.useState({}),[S,T]=b.useState(""),[_,x]=b.useState(""),[D,s]=b.useState([]),[l,j]=b.useState("en"),[o,w]=b.useState(!0),[A,E]=b.useState(""),[L,v]=b.useState(!1),{handlerTextTranslateHandler:H}=xe(),{register:t,handleSubmit:u,setValue:a,clearErrors:h,reset:F,formState:{errors:W}}=oe(),Y=async({name:g,description:r})=>{var M,R;try{v(!0);const N=await H(g,l,d==null?void 0:d.name),J=await H(r,l,d==null?void 0:d.description),V={name:{...N,[l]:g},description:{...J,[l]:r||""},parentId:S||void 0,parentName:A||"Home",icon:_,status:o?"show":"hide",lang:l};if(i){const O=await P.updateCategory(i,V);p(!0),v(!1),q(O.message),f(),F()}else{const O=await P.addCategory(V);p(!0),v(!1),q(O.message),f()}}catch(N){v(!1),B(N?(R=(M=N==null?void 0:N.response)==null?void 0:M.data)==null?void 0:R.message:N==null?void 0:N.message),f()}},G=g=>{j(g),Object.keys(d).length>0&&(a("name",d.name[g||"en"]),a("description",d.description[g||"en"]))};return b.useEffect(()=>{var g;if(!n){C({}),a("name"),a("parentId"),a("parentName"),a("description"),a("icon"),x(""),w(!0),h("name"),h("parentId"),h("parentName"),h("description"),E("Home"),j(I),a("language",l),c!==void 0&&((g=c[0])==null?void 0:g._id)!==void 0&&T(c[0]._id);return}i&&(async()=>{try{const r=await P.getCategoryById(i);r&&(C(r),a("name",r.name[l||"en"]),a("description",r.description[l||"en"]),a("language",l),a("parentId",r.parentId),a("parentName",r.parentName),E(r.parentName),T(r.parentId),x(r.icon),w(r.status==="show"))}catch(r){B(r?r.response.data.message:r.message)}})()},[i,a,n,l,h,c,I]),{register:t,handleSubmit:u,onSubmit:Y,errors:W,imageUrl:_,setImageUrl:x,children:D,setChildren:s,published:o,setPublished:w,checked:S,setChecked:T,isSubmitting:L,selectCategoryName:A,setSelectCategoryName:E,handleSelectLanguage:G}},he=({id:i,data:c})=>{const{t:n}=X(),{checked:f,register:p,onSubmit:I,handleSubmit:d,errors:C,imageUrl:S,setImageUrl:T,published:_,setPublished:x,setChecked:D,selectCategoryName:s,setSelectCategoryName:l,handleSelectLanguage:j,isSubmitting:o}=ue(i,c),{showingTranslateValue:w}=K(),A=`
  .rc-tree-child-tree {
    display: hidden;
  }
  .node-motion {
    transition: all .3s;
    overflow-y: hidden;
  }
`,E={motionName:"node-motion",motionAppear:!1,onAppearStart:t=>({height:0}),onAppearActive:t=>({height:t.scrollHeight}),onLeaveStart:t=>({height:t.offsetHeight}),onLeaveActive:()=>({height:0})},L=t=>{let u=[];for(let a of t)u.push({title:w(a.name),key:a._id,children:a.children.length>0&&L(a.children)});return u},v=(t,u)=>{var a;return t._id===u?t:(a=t==null?void 0:t.children)==null?void 0:a.reduce((h,F)=>h??v(F,u),void 0)},H=async t=>{if(t!==void 0)if(i){const u=await P.getCategoryById(t);if(i===t)return B("This can't be select as a parent category!");if(i===u.parentId)return B("This can't be select as a parent category!");{if(t===void 0)return;D(t);const a=c[0],h=v(a,t);l(w(h==null?void 0:h.name))}}else{if(t===void 0)return;D(t);const u=c[0],a=v(u,t);l(w(a==null?void 0:a.name))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:i?e.jsx(k,{register:p,handleSelectLanguage:j,title:n("UpdateCategory"),description:n("UpdateCategoryDescription")}):e.jsx(k,{register:p,handleSelectLanguage:j,title:n("AddCategoryTitle"),description:n("AddCategoryDescription")})}),e.jsx(Z,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:d(I),children:[e.jsxs("div",{className:"p-6 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(U,{label:n("Name")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(me,{required:!0,register:p,label:"Category title",name:"name",type:"text",placeholder:n("ParentCategoryPlaceholder")}),e.jsx(z,{errorName:C.name})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(U,{label:n("Description")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(ee,{register:p,label:"Description",name:"description",type:"text",placeholder:"Category Description"}),e.jsx(z,{errorName:C.description})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(U,{label:n("ParentCategory")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4 relative",children:[e.jsx(m.Input,{readOnly:!0,...p("parent",{required:!1}),name:"parent",value:s||"Home",placeholder:n("ParentCategory"),type:"text"}),e.jsxs("div",{className:"draggable-demo capitalize",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:A}}),e.jsx(de,{expandAction:"click",treeData:L(c),selectedKeys:[f],onSelect:t=>H(t[0]),motion:E,animation:"slide-up"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(U,{label:n("CategoryIcon")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(pe,{imageUrl:S,setImageUrl:T,folder:"category",targetWidth:238,targetHeight:238})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(U,{label:n("Published")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ce,{handleProcess:x,processOption:_})})]})]}),e.jsx(te,{id:i,title:"Category",isSubmitting:o})]})})]})},Ae=({data:i,lang:c,isCheck:n,categories:f,setIsCheck:p,useParamId:I,showChild:d})=>{const{title:C,serviceId:S,handleModalOpen:T,handleUpdate:_}=ne(),{showingTranslateValue:x}=K(),D=s=>{const{id:l,checked:j}=s.target;p([...n,l]),j||p(n.filter(o=>o!==l))};return e.jsxs(e.Fragment,{children:[(n==null?void 0:n.length)<1&&e.jsx(re,{useParamId:I,id:S,title:C}),e.jsx(le,{children:e.jsx(he,{id:S,data:i,lang:c})}),e.jsx(m.TableBody,{children:f==null?void 0:f.map(s=>{var l,j;return e.jsxs(m.TableRow,{children:[e.jsx(m.TableCell,{children:e.jsx(se,{type:"checkbox",name:"category",id:s._id,handleClick:D,isChecked:n==null?void 0:n.includes(s._id)})}),e.jsx(m.TableCell,{className:"font-semibold uppercase text-xs",children:(l=s==null?void 0:s._id)==null?void 0:l.substring(20,24)}),e.jsx(m.TableCell,{children:s!=null&&s.icon?e.jsx(m.Avatar,{className:"hidden mr-3 md:block bg-gray-50 p-1",src:s==null?void 0:s.icon,alt:s==null?void 0:s.parent}):e.jsx(m.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product",className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none"})}),e.jsx(m.TableCell,{className:"font-medium text-sm ",children:(s==null?void 0:s.children.length)>0?e.jsxs($,{to:`/categories/${s==null?void 0:s._id}`,className:"text-blue-700",children:[x(s==null?void 0:s.name),e.jsx(e.Fragment,{children:d&&e.jsxs(e.Fragment,{children:[" ",e.jsx("div",{className:"pl-2 ",children:(j=s==null?void 0:s.children)==null?void 0:j.map(o=>e.jsx("div",{children:e.jsx($,{to:`/categories/${o==null?void 0:o._id}`,className:"text-blue-700",children:e.jsxs("div",{className:"flex text-xs items-center  text-blue-800",children:[e.jsx("span",{className:" text-xs text-gray-500 pr-1",children:e.jsx(y,{})}),e.jsx("span",{className:"text-gray-500",children:x(o.name)})]})})},o._id))})]})})]}):e.jsx("span",{children:x(s==null?void 0:s.name)})}),e.jsx(m.TableCell,{className:"text-sm",children:x(s==null?void 0:s.description)}),e.jsx(m.TableCell,{className:"text-center",children:e.jsx(ae,{id:s._id,category:!0,status:s.status})}),e.jsx(m.TableCell,{children:e.jsx(ie,{id:s==null?void 0:s._id,parent:s,isCheck:n,children:s==null?void 0:s.children,handleUpdate:_,handleModalOpen:T,title:x(s==null?void 0:s.name)})})]},s._id)})})]})};export{he as C,Ae as a};
