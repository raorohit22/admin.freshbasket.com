import{d as w}from"./Layout-CJRk6bmQ.js";import{r as s,A as G,S as H,u as J,f as M,q as U,s as _}from"./index-JntRuJ30.js";import{u as z}from"./index.esm-NZsJ6F5_.js";import{A as y}from"./AdminServices-4nH-LU8a.js";import{u as K}from"./useTranslationValue-aEJQtv0R.js";const ee=c=>{const{state:C,dispatch:L}=s.useContext(G),{adminInfo:r}=C,{isDrawerOpen:Y,closeDrawer:D,setIsUpdate:b,lang:k}=s.useContext(H),[j,f]=s.useState(""),[h,x]=s.useState(w(new Date).format("YYYY-MM-DD")),[o,O]=s.useState("en"),[n,T]=s.useState({}),[v,p]=s.useState(!1),[g,A]=s.useState([]),E=J(),{handlerTextTranslateHandler:N}=K(),{register:R,handleSubmit:V,setValue:t,clearErrors:i,formState:{errors:q}}=z(),B=async a=>{var l,u;try{p(!0);const S={name:{...await N(a.name,o,n==null?void 0:n.name),[o]:a.name},email:a.email,password:a.password,phone:a.phone,role:a.role,access_list:g==null?void 0:g.map(m=>m.value),joiningDate:h||w(new Date).format("YYYY-MM-DD"),image:j,lang:o},d=(r==null?void 0:r._id)===(n==null?void 0:n._id);if(c){const m=await y.updateStaff(c,S);d&&(L({type:"USER_LOGIN",payload:m}),M.set("adminInfo",JSON.stringify(m),{expires:.5,sameSite:"None",secure:!0})),b(!0),p(!1),U("Staff Updated Successfully!"),D()}else{const m=await y.addStaff(S);b(!0),p(!1),U(m.message),D()}}catch(e){_(e?(u=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:u.message:e==null?void 0:e.message),p(!1),D()}},I=async()=>{var a,l,u;try{const e=await y.getStaffById(c,{email:r.email});if(e){T(e),t("name",e.name[o||"en"]),t("email",e.email),t("password"),t("phone",e.phone),t("role",e.role),x(w(e.joiningData).format("YYYY-MM-DD")),f(e.image);const S=(a=e==null?void 0:e.access_list)==null?void 0:a.map(d=>({label:d,value:d}));A(S)}}catch(e){_(e?(u=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:u.message:e==null?void 0:e.message)}},F=a=>{O(a),Object.keys(n).length>0&&t("name",n.name[a||"en"])};return s.useEffect(()=>{if(!Y){T({}),t("name"),t("email"),t("password"),t("phone"),t("role"),t("joiningDate"),f(""),i("name"),i("email"),i("password"),i("phone"),i("role"),i("joiningDate"),f(""),O(k),t("language",o);return}c&&I()},[c,t,Y,r.email,i]),s.useEffect(()=>{E.pathname==="/edit-profile"&&M.get("adminInfo")&&I()},[E.pathname,t]),{register:R,handleSubmit:V,onSubmit:B,language:o,errors:q,adminInfo:r,setImageUrl:f,imageUrl:j,selectedDate:h,setSelectedDate:x,isSubmitting:v,accessedRoutes:g,setAccessedRoutes:A,handleSelectLanguage:F}};export{ee as u};
